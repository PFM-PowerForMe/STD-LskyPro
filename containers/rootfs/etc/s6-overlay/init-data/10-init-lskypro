#!/usr/bin/env bash

CONFIG_FILE="/var/www/.env"
cat << EOF | tee "${CONFIG_FILE}"
# 应用配置
APP_NAME="${APP_NAME:-Lsky Pro}"
APP_ENV=${APP_ENV:-production}
APP_KEY=${APP_KEY:-base64:X6mZWPqoUCpvLbZHKwbdJvmS0UqBdSgqjKZxG5UqGNw=}
APP_DEBUG=${APP_DEBUG:-false}
APP_URL=${APP_URL:-http://localhost}
# 数据库配置
DB_CONNECTION=${DB_CONNECTION:-mysql}
DB_HOST=${DB_HOST:-lskypro-db}
DB_PORT=${DB_PORT:-3306}
DB_DATABASE=${DB_DATABASE:-lsky_pro_db}
DB_USERNAME=${DB_USERNAME:-lsky_pro_db_user}
DB_PASSWORD=${DB_PASSWORD:-lsky_pro_db_user_passwd}
# Redis 缓存配置
CACHE_DRIVER=${CACHE_DRIVER:-file}
REDIS_HOST=${REDIS_HOST:-127.0.0.1}
REDIS_PASSWORD=${REDIS_PASSWORD:-null}
REDIS_PORT=${REDIS_PORT:-6379}
REDIS_CACHE_DB=${REDIS_CACHE_DB:-1}
# 会话配置
REDIS_DB=${REDIS_DB:-0}
SESSION_DRIVER=${SESSION_DRIVER:-file}
SESSION_LIFETIME=${SESSION_LIFETIME:-1440}
SESSION_CONNECTION=${SESSION_CONNECTION:-default}
# 队列配置
QUEUE_CONNECTION=${QUEUE_CONNECTION:-sync}
# 其它
LOG_CHANNEL=${LOG_CHANNEL:-daily}
LOG_DEPRECATIONS_CHANNEL=${LOG_DEPRECATIONS_CHANNEL:-null}
LOG_LEVEL=${LOG_LEVEL:-debug}
BROADCAST_DRIVER=${BROADCAST_DRIVER:-log}
FILESYSTEM_DISK=${FILESYSTEM_DISK:-public}
MEMCACHED_HOST=${MEMCACHED_HOST:-127.0.0.1}
IGNITION_SHARING_ENABLED=${IGNITION_SHARING_ENABLED:-false}
PUSHER_APP_ID=${PUSHER_APP_ID}
PUSHER_APP_KEY=${PUSHER_APP_KEY}
PUSHER_APP_SECRET=${PUSHER_APP_SECRET}
PUSHER_APP_CLUSTER=${PUSHER_APP_CLUSTER:-mt1}
MIX_PUSHER_APP_KEY="\${PUSHER_APP_KEY}"
MIX_PUSHER_APP_CLUSTER="\${PUSHER_APP_CLUSTER}"
EOF

if [ "${INSTALLD:-false}" == "false" ]; then
    touch /var/www/installed.lock
else
    echo "环境变量: INSTALLD 已设置全新安装"
fi

chown -R www-data:www-data /var/www/
